# ============================================
# Nginx Server Configuration cho Staging Environment
# ============================================
# File này định nghĩa virtual host và reverse proxy rules
# Hỗ trợ cả domain name và IP address

# ============================================
# HTTP Server Block (Port 80)
# ============================================
server {
    # listen 80: Lắng nghe HTTP requests trên port 80
    listen 80;
    
    # server_name: Các domains/IPs mà server này sẽ respond
    # localhost: Cho local testing
    # _: Wildcard - accept bất kỳ domain/IP nào (bao gồm IP VPS)
    server_name localhost _;
    
    # ============================================
    # Health Check Endpoint
    # ============================================
    # Endpoint để check xem Nginx có hoạt động không
    location /health {
        # access_log off: Không log health check requests
        access_log off;
        
        # return 200: Trả về HTTP 200 với message "healthy"
        return 200 "healthy\n";
        
        # add_header: Set Content-Type cho response
        add_header Content-Type text/plain;
    }
    
    # ============================================
    # SSL Redirect (Uncomment khi có SSL)
    # ============================================
    # Nếu có domain và SSL certificate, uncomment block dưới để redirect HTTP -> HTTPS
    # if ($server_name = staging.yourdomain.com) {
    #     return 301 https://$server_name$request_uri;
    # }
    
    # ============================================
    # Include Location Rules
    # ============================================
    # Load tất cả routing rules từ locations.conf
    # Đây là nơi định nghĩa cách route requests đến API và Frontend
    include /etc/nginx/conf.d/locations.conf;
}

# HTTPS Server (uncomment khi có SSL certificate)
# server {
#     listen 443 ssl http2;
#     server_name staging.yourdomain.com;
# 
#     # SSL Configuration
#     ssl_certificate /etc/nginx/ssl/fullchain.pem;
#     ssl_certificate_key /etc/nginx/ssl/privkey.pem;
#     ssl_session_cache shared:le_nginx_SSL:10m;
#     ssl_session_timeout 1440m;
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_prefer_server_ciphers off;
#     ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
# 
#     # HSTS (optional)
#     add_header Strict-Transport-Security "max-age=63072000" always;
# 
#     include /etc/nginx/conf.d/locations.conf;
# } 